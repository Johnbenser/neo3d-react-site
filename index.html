<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Benser Anatomy Explorer 3D</title>
  <style>
    * { box-sizing: border-box; }
    html, body { margin: 0; height: 100%; overflow: hidden; font-family: Inter, system-ui, Arial, sans-serif; background: #060914; color: #e5e7eb; }
    #app { position: fixed; inset: 0; }
    .hud { position: fixed; inset: 12px 12px auto 12px; display: flex; justify-content: space-between; gap: 10px; z-index: 10; pointer-events: none; }
    .chip { pointer-events: auto; background: rgba(12,18,36,.6); border: 1px solid rgba(255,255,255,.2); border-radius: 999px; padding: 8px 12px; font-size: 12px; backdrop-filter: blur(8px); }
    .controls { position: fixed; right: 12px; top: 56px; width: min(360px, 92vw); max-height: 84vh; overflow: auto; z-index: 12; background: rgba(10,16,30,.75); border: 1px solid rgba(255,255,255,.15); border-radius: 14px; padding: 12px; backdrop-filter: blur(10px); }
    .controls h2 { margin: 4px 0 10px; font-size: 17px; }
    .row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px; }
    button { border: 1px solid rgba(255,255,255,.18); background: rgba(255,255,255,.07); color: #dbeafe; border-radius: 999px; padding: 7px 11px; font-size: 12px; cursor: pointer; }
    button.active { background: linear-gradient(90deg,#22d3ee,#8b5cf6); color: #031122; font-weight: 700; }
    .card { border: 1px solid rgba(255,255,255,.15); border-radius: 12px; padding: 10px; margin-top: 8px; background: rgba(255,255,255,.04); }
    .name { font-weight: 700; color: #67e8f9; }
    .meta { font-size: 12px; opacity: .86; margin-top: 4px; line-height: 1.35; }
    .legend { font-size: 12px; opacity: .9; line-height: 1.35; }
    .small { font-size: 11px; opacity: .75; }
    .footer { margin-top: 8px; font-size: 11px; opacity: .72; }
    @media (max-width: 900px){ .controls { left: 12px; right: 12px; top: auto; bottom: 12px; width: auto; max-height: 42vh; } }
  </style>
</head>
<body>
  <div id="app"></div>

  <div class="hud">
    <div class="chip">ðŸ§  Benser Anatomy Explorer 3D</div>
    <div id="fps" class="chip">FPS: --</div>
  </div>

  <aside class="controls">
    <h2>Systems</h2>
    <div id="systemButtons" class="row"></div>
    <div class="legend">Tap/click an organ to inspect details. Drag to orbit. Scroll/pinch to zoom.</div>
    <div id="organInfo" class="card">
      <div class="name">Select an organ</div>
      <div class="meta">Explore the body model and choose any highlighted structure.</div>
    </div>
    <div class="footer">Educational visualization only â€” not a clinical diagnostic tool.</div>
  </aside>

  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js';

    const anatomyData = [
      { id:'brain', system:'Nervous', color:0xff7ab6, shape:'sphere', scale:[0.55,0.42,0.58], pos:[0,2.18,0], facts:['Cortex + cerebellum + brainstem integration','~86 billion neurons','Consumes high oxygen/glucose demand'], blood:'Internal carotid + vertebrobasilar', note:'Controls cognition, motor planning, sensory integration.' },
      { id:'heart', system:'Cardiovascular', color:0xff4d4d, shape:'sphere', scale:[0.48,0.56,0.42], pos:[0.16,1.08,0.1], facts:['4 chambers','Cardiac cycle driven by conduction system','Average adult resting output ~5 L/min'], blood:'Coronary arteries', note:'Pumps blood through pulmonary/systemic circuits.' },
      { id:'left_lung', system:'Respiratory', color:0x7dd3fc, shape:'sphere', scale:[0.52,0.8,0.42], pos:[-0.5,1.1,0.02], facts:['2 lobes','Alveolar gas exchange surface','Elastic recoil during expiration'], blood:'Pulmonary + bronchial circulation', note:'Oxygenates blood and removes CO2.' },
      { id:'right_lung', system:'Respiratory', color:0x7dd3fc, shape:'sphere', scale:[0.58,0.88,0.46], pos:[0.58,1.12,0.02], facts:['3 lobes','Higher right hemidiaphragm relation','Major airway bifurcation landmarks'], blood:'Pulmonary + bronchial circulation', note:'Pairs with left lung for ventilation/perfusion.' },
      { id:'liver', system:'Digestive', color:0xf59e0b, shape:'capsule', scale:[0.9,0.35,0.48], pos:[0.45,0.28,0.12], facts:['Largest internal organ','Bile production + metabolism','Detoxification + glycogen storage'], blood:'Portal vein + hepatic artery', note:'Central metabolic hub and nutrient processing.' },
      { id:'stomach', system:'Digestive', color:0xf97316, shape:'capsule', scale:[0.45,0.55,0.35], pos:[-0.25,0.35,0.16], facts:['Mechanical + chemical digestion','Acid + pepsin activity','Pyloric emptying control'], blood:'Left/right gastric arteries', note:'Initial protein breakdown and bolus mixing.' },
      { id:'pancreas', system:'Digestive', color:0xfacc15, shape:'capsule', scale:[0.72,0.18,0.2], pos:[0.05,0.18,0.18], facts:['Exocrine enzymes','Endocrine islets (insulin/glucagon)','Retroperitoneal relation'], blood:'Splenic + pancreaticoduodenal branches', note:'Supports digestion and glucose regulation.' },
      { id:'left_kidney', system:'Urinary', color:0x8b5cf6, shape:'kidney', scale:[0.24,0.45,0.2], pos:[-0.4,-0.32,0.08], facts:['Nephron filtration','Renin/erythropoietin activity','Fluid-electrolyte balancing'], blood:'Renal artery', note:'Filters blood and forms urine.' },
      { id:'right_kidney', system:'Urinary', color:0x8b5cf6, shape:'kidney', scale:[0.24,0.45,0.2], pos:[0.42,-0.33,0.08], facts:['Right kidney slightly lower','Acid-base support','Water balance control'], blood:'Renal artery', note:'Maintains homeostasis with paired filtration.' },
      { id:'small_intestine', system:'Digestive', color:0x34d399, shape:'coil', scale:[0.95,0.75,0.55], pos:[0,-0.7,0.06], facts:['Primary nutrient absorption','Villi and microvilli amplification','~6m average adult length'], blood:'Superior mesenteric branches', note:'Main site of digestion absorption.' },
      { id:'spine', system:'Skeletal', color:0xe5e7eb, shape:'spine', scale:[0.2,1.9,0.2], pos:[0,0.6,-0.18], facts:['Cervical/thoracic/lumbar segments','Intervertebral discs for shock absorption','Protects spinal cord'], blood:'Segmental arterial network', note:'Axial support and neural protection.' },
      { id:'pelvis', system:'Skeletal', color:0xd4d4d8, shape:'ring', scale:[0.9,0.48,0.42], pos:[0,-1.3,-0.05], facts:['Weight transfer to lower limbs','Supports pelvic organs','Important obstetric dimensions'], blood:'Internal iliac branches', note:'Load-bearing structure and organ support.' }
    ];

    const app = document.getElementById('app');
    const fpsEl = document.getElementById('fps');
    const infoEl = document.getElementById('organInfo');
    const btnWrap = document.getElementById('systemButtons');

    const systems = ['All', ...new Set(anatomyData.map(o => o.system))];
    let activeSystem = 'All';

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x060914);
    scene.fog = new THREE.Fog(0x060914, 8, 24);

    const camera = new THREE.PerspectiveCamera(48, innerWidth / innerHeight, 0.1, 100);
    camera.position.set(0, 0.9, 8);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    renderer.setSize(innerWidth, innerHeight);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    app.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.minDistance = 3.6;
    controls.maxDistance = 16;
    controls.target.set(0, 0.35, 0);

    scene.add(new THREE.AmbientLight(0x9aa5ff, 0.65));
    const key = new THREE.PointLight(0x67e8f9, 1.5, 50); key.position.set(4, 5, 4); scene.add(key);
    const rim = new THREE.PointLight(0xa78bfa, 1.2, 40); rim.position.set(-4, 1, -4); scene.add(rim);

    // Body shell silhouette
    const shellGeo = new THREE.CapsuleGeometry(1.2, 4.1, 10, 24);
    const shellMat = new THREE.MeshPhysicalMaterial({ color: 0x1a2338, transparent: true, opacity: 0.22, roughness: 0.35, metalness: 0.05, clearcoat: 0.6, transmission: 0.2 });
    const shell = new THREE.Mesh(shellGeo, shellMat);
    shell.position.y = 0.25;
    scene.add(shell);

    // Grid floor
    const grid = new THREE.GridHelper(30, 40, 0x1f355d, 0x12203a);
    grid.position.y = -2.2;
    scene.add(grid);

    const organGroup = new THREE.Group();
    scene.add(organGroup);

    const organs = [];
    const makeMat = c => new THREE.MeshStandardMaterial({ color: c, emissive: c, emissiveIntensity: 0.12, roughness: 0.45, metalness: 0.2 });

    function geoByShape(shape){
      if (shape === 'sphere') return new THREE.SphereGeometry(1, 24, 18);
      if (shape === 'capsule') return new THREE.CapsuleGeometry(0.55, 1.2, 8, 16);
      if (shape === 'ring') return new THREE.TorusGeometry(0.95, 0.25, 14, 40);
      if (shape === 'coil') return new THREE.TorusKnotGeometry(0.55, 0.18, 120, 14, 2, 3);
      if (shape === 'spine') return new THREE.CylinderGeometry(0.17, 0.2, 2.2, 18);
      if (shape === 'kidney') return new THREE.TorusGeometry(0.55, 0.25, 18, 50, Math.PI * 1.55);
      return new THREE.BoxGeometry(1,1,1);
    }

    anatomyData.forEach((d, idx) => {
      const m = new THREE.Mesh(geoByShape(d.shape), makeMat(d.color));
      m.position.set(...d.pos);
      m.scale.set(...d.scale);
      m.rotation.y = idx * 0.19;
      m.userData = d;
      m.renderOrder = 2;
      organGroup.add(m);
      organs.push(m);
    });

    const haloGeo = new THREE.SphereGeometry(1.06, 24, 18);
    const haloMat = new THREE.MeshBasicMaterial({ color: 0xffffff, wireframe: true, transparent: true, opacity: 0 });
    const halo = new THREE.Mesh(haloGeo, haloMat);
    halo.visible = false;
    scene.add(halo);

    function setInfo(data){
      infoEl.innerHTML = `
        <div class="name">${data.id.replaceAll('_',' ').toUpperCase()}</div>
        <div class="meta"><strong>System:</strong> ${data.system}</div>
        <div class="meta"><strong>Key Facts:</strong><br/>â€¢ ${data.facts.join('<br/>â€¢ ')}</div>
        <div class="meta"><strong>Blood Supply:</strong> ${data.blood}</div>
        <div class="meta"><strong>Role:</strong> ${data.note}</div>
      `;
    }

    function buildButtons(){
      btnWrap.innerHTML = '';
      systems.forEach(s => {
        const b = document.createElement('button');
        b.textContent = s;
        if (s === activeSystem) b.classList.add('active');
        b.onclick = () => {
          activeSystem = s;
          [...btnWrap.children].forEach(x => x.classList.remove('active'));
          b.classList.add('active');
          organs.forEach(o => {
            const on = s === 'All' || o.userData.system === s;
            o.visible = on;
            o.material.opacity = on ? 1 : 0.08;
            o.material.transparent = !on;
          });
        };
        btnWrap.appendChild(b);
      });
    }
    buildButtons();

    const raycaster = new THREE.Raycaster();
    const pointer = new THREE.Vector2();
    let selected = null;

    function pick(clientX, clientY){
      pointer.x = (clientX / innerWidth) * 2 - 1;
      pointer.y = -(clientY / innerHeight) * 2 + 1;
      raycaster.setFromCamera(pointer, camera);
      const hits = raycaster.intersectObjects(organs.filter(o => o.visible));
      if (hits.length){
        selected = hits[0].object;
        setInfo(selected.userData);
      }
    }
    addEventListener('click', e => pick(e.clientX, e.clientY));
    addEventListener('touchstart', e => { const t=e.touches[0]; if(t) pick(t.clientX,t.clientY); }, { passive:true });

    addEventListener('resize', () => {
      camera.aspect = innerWidth / innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
      renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    });

    let f = 0, acc = 0, prev = performance.now();
    const clock = new THREE.Clock();
    function loop(){
      const t = clock.getElapsedTime();
      controls.update();

      organs.forEach((o, i) => {
        o.rotation.y += 0.004 + (i % 3) * 0.0008;
        o.position.z += Math.sin(t * 0.8 + i) * 0.0007;
      });

      shell.material.emissive = new THREE.Color(0x0f1b33);
      shell.material.emissiveIntensity = 0.08 + Math.sin(t * 1.2) * 0.03;

      if (selected){
        halo.visible = true;
        halo.position.copy(selected.position);
        halo.scale.copy(selected.scale).multiplyScalar(0.75 + Math.sin(t * 3.2) * 0.04);
      } else halo.visible = false;

      renderer.render(scene, camera);
      requestAnimationFrame(loop);

      const now = performance.now();
      const dt = now - prev; prev = now; acc += dt; f++;
      if (acc > 500){ fpsEl.textContent = `FPS: ${Math.round((f * 1000) / acc)}`; f = 0; acc = 0; }
    }
    loop();
  </script>
</body>
</html>